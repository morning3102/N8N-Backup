{
  "updatedAt": "2026-02-06T06:12:39.000Z",
  "createdAt": "2025-12-01T07:08:04.222Z",
  "id": "037oeU0xxB2nPCMT",
  "name": "SHOPEE",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a74b3118-d2f8-45fa-9986-b7a2960c9dd3",
              "leftValue": "={{ $json.name.toLowerCase() }}",
              "rightValue": "={{ \"((\" + $('Config variable for regex1').item.json.monthShortName.toLowerCase() + \"|\" + $('Config variable for regex1').item.json.monthName.toLowerCase() + \")[\\\\w\\\\s.-]*)\" +$('Config variable for regex1').item.json.year   }}",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            },
            {
              "id": "32cc8ee7-a407-4bbe-951b-406acddc1404",
              "leftValue": "={{ $json.name.toLowerCase() }}",
              "rightValue": "={{ \".*\" + $('Config Folder & Brand1').item.json.brandName.toLowerCase() + \".*\" }}",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            },
            {
              "id": "049d338f-cb58-4c04-b7e4-760ec5ddd004",
              "leftValue": "={{ $json.name.toLowerCase() }}",
              "rightValue": "={{ \".*\" + \"shopee\".toLowerCase() + \".*\" }}",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -928,
        208
      ],
      "id": "4ecf5d5b-41bf-4ef4-86c4-b92201601f6b",
      "name": "Filterfiles_Shopee1",
      "alwaysOutputData": true,
      "executeOnce": false
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0a6fd955-432c-4927-a125-d21c59d0724b",
              "leftValue": "={{ $json.id }}",
              "rightValue": 0,
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -704,
        208
      ],
      "id": "432934ba-1d39-4b7e-a8f3-2bdd308e6c23",
      "name": "If have file3"
    },
    {
      "parameters": {
        "jsCode": "const requiredColumns = [\n      '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',\n      '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',\n      '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',\n      '‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á SKU (SKU Reference No.)',\n      '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',\n      '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',\n      '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', \n      '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô',\n      '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô',\n      '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥', \n      '‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢',\n      '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',\n      '‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'\n]\n\n// ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Input\nconst items = $input.all();\nconst returnData = [];\n\n// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠ Platform ‡∏ï‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Node ‡∏ô‡∏µ‡πâ\nconst currentPlatform = 'Shopee';\n\n// üõ°Ô∏è PART 1: VALIDATION CHECK\n// ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏´‡∏°\nif (!items.length || !items[0].json) {\n  // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ throw ‡πÄ‡∏£‡∏≤ return ‡∏Ñ‡πà‡∏≤ Error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡πÜ\n  return [{\n    json: {\n      error: true,\n      errorMessage: `‚ö†Ô∏è [${currentPlatform}] ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Input (Empty Dataset)`\n    }\n  }];\n}\n\nconst firstRow = items[0].json;\nconst actualKeys = Object.keys(firstRow).map(k => k.trim().toLowerCase());\n\n// ‡∏´‡∏≤‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢\nconst missingColumns = requiredColumns.filter(reqCol => {\n  return !actualKeys.includes(reqCol.toLowerCase());\n});\n\n// üö® ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏´‡∏≤‡∏¢\nif (missingColumns.length > 0) {\n  const missingList = missingColumns.join(', ');\n  // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏ö‡∏≠‡∏Å Node ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ß‡πà‡∏≤ \"‡∏â‡∏±‡∏ô‡∏û‡∏±‡∏á‡∏ô‡∏∞\" ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ï‡πá‡∏°‡πÜ\n  return [{\n    json: {\n      error: true,\n      errorMessage: `‚ö†Ô∏è [${currentPlatform}] ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö! ‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: ${missingList}`\n    }\n  }];\n}\n\n// ‚öôÔ∏è PART 2: TRANSFORMATION\nfor (const item of items) {\n  const row = item.json; \n  \n  // Helper Function\n  const get = (colName) => {\n    if (!colName) return null;\n    const key = Object.keys(row).find(k => k.trim().toLowerCase() === colName.trim().toLowerCase());\n    return key ? row[key] : null;\n  };\n\n  // Logic ‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á SHOPEE\n  const originalPrice = parseFloat(get('‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô')) || 0;\n  const netPrice = parseFloat(get('‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥')) || 0;\n   \n  const finalRow = {\n      \"Platform name\": currentPlatform,\n      \"Order ID\": get('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠'),\n      \"Order status\": get('‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠'),\n      \"Cancelation/Return Type\": get('‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'),\n      \"Seller SKU\": get('‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á SKU (SKU Reference No.)'),\n      \"Product Name\": get('‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'),\n      \"Payment Method\": get('‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô'),\n      \"Quantity\": parseInt(get('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô')) || 0, \n      \"Quantity of return\": get('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô'),\n      \"SKU Unit Original Price\": originalPrice,\n      \"SKU Subtotal Before Discount\": netPrice,\n      \"SKU Subtotal After Discount\": null,\n      \"Direct Discount\": originalPrice - netPrice, \n      \"Voucher Discount\": get('‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢'),\n      \"Created Time\": get('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠'),\n      \"Delivered Time\": get('‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤')\n  };\n\n  // Push ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\n  returnData.push({ json: finalRow });\n}\n\nreturn returnData;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16,
        192
      ],
      "id": "db08c933-544a-46fd-bd4b-cb0b0e92dd59",
      "name": "Data transformation SH1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "fileFolder",
        "queryString": "=",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Config Folder & Brand1').item.json.folder_Shopee }}",
            "mode": "id"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1152,
        208
      ],
      "id": "6246e44c-2dd3-4848-873e-a94d654bd08d",
      "name": "Search files and folders SHOPEE1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "1w4Q3todiZw4BNKd",
          "name": "reimburse"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "headerRow": false
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        448,
        176
      ],
      "id": "6db8cee6-5c70-4035-b231-94bcc6a799b5",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "command": "echo >> /home/node/final_report.csv"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        896,
        176
      ],
      "id": "bdc0655e-93ec-464e-9050-355be76bc30f",
      "name": "enter new line"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1728,
        208
      ],
      "id": "796ec77e-9d27-4a4d-8196-ec0ead009cc9",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "batchSize": 2000,
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -208,
        176
      ],
      "id": "9c42a876-d8e0-4933-bb31-8e01399227fc",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\n\n\nconst date = new Date();\n// ‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏õ 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß)\ndate.setDate(0); \n\nconst monthNames = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n  \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n];\nconst monthShortNames = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\",\n  \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"\n];\n\nreturn {\n  year: date.getFullYear().toString(),\n  monthNumber: ('0' + (date.getMonth() + 1)).slice(-2),\n  monthName: monthNames[date.getMonth()],\n  monthShortName: monthShortNames[date.getMonth()]\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1344,
        208
      ],
      "id": "62d7aadb-8d9c-4ec9-b318-50ffd3071cbd",
      "name": "Config variable for regex1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "104447ca-270c-4c63-8ac3-31120cc42ce6",
              "name": "=brandName",
              "value": "={{ $json.body.brand_name }}",
              "type": "string"
            },
            {
              "id": "70f67873-a248-4266-8faf-4419677925c1",
              "name": "folder_Shopee",
              "value": "18h85AfnPI_NhUzqwcMIH8Xw3rLV43Vzv",
              "type": "string"
            },
            {
              "id": "5ed80f42-ebc6-41d6-be6e-29448772e4a3",
              "name": "folder_Archive",
              "value": "13iVrXbXVcvAE6cAGU1enFAarUih5L8Ar",
              "type": "string"
            },
            {
              "id": "09b26435-9769-44cb-b437-39fa5f88e95e",
              "name": "folder_final_reports",
              "value": "1f5B2RL2a9QnEFCK0GkMD8zTOlWYh5cRd",
              "type": "string"
            },
            {
              "id": "43e2d48c-c0cd-42f1-b4dc-c0dd0136506b",
              "name": "parent_drive",
              "value": "1TYSAJPuU9njhxnzFCilbxCkDt4f90k7X",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1568,
        208
      ],
      "id": "3eaf2eaf-ae6f-4e1c-9523-93fc99484a7a",
      "name": "Config Folder & Brand1"
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {
          "includeEmptyCells": true
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1.1,
      "position": [
        -464,
        832
      ],
      "id": "05efae0e-a36e-49b4-95f7-a05508a8a2ba",
      "name": "Extract from File Shopee1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -464,
        576
      ],
      "id": "9f4a121c-09ab-4da6-8c01-daaea929a880",
      "name": "Download file Shopee",
      "executeOnce": false,
      "alwaysOutputData": true,
      "notesInFlow": false,
      "retryOnFail": true,
      "waitBetweenTries": 1000,
      "credentials": {
        "googleApi": {
          "id": "1w4Q3todiZw4BNKd",
          "name": "reimburse"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -464,
        192
      ],
      "id": "b1a72408-96a5-4f35-8852-603bdfa3a4bb",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://chat.googleapis.com/v1/spaces/AAQA4vVH8yY/messages?key=AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=mDogCDO_DXBkboDcHu6YLs8nds4F589Y7-Gh6mwsNNI",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "=üö®{{ $('Config Folder & Brand1').first().json.brandName }}\n‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î\n{{ $json.errorMessage }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        240,
        448
      ],
      "id": "859cc454-6404-446d-b1ab-35a009422284",
      "name": "Notify",
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c932f70b-0b82-4dfb-9d07-0eb55929e788",
              "leftValue": "={{ $json.error }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        224,
        192
      ],
      "id": "761d7d39-9020-4c47-8652-78039aa58959",
      "name": "If not error"
    },
    {
      "parameters": {
        "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nconst allFiles = $('Filterfiles_Shopee1').all().map(item => item.json);\n\nreturn allFiles.map(file => {\n  return {\n    json: {\n      fileId: file.id\n    }\n  }\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        0
      ],
      "id": "b695f402-dc4e-44d0-8201-a342ac1a1f0e",
      "name": "Extract fileID",
      "executeOnce": true
    },
    {
      "parameters": {
        "jsCode": "// ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ö‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏°‡πà‡∏ß‡πà‡∏≤ \"‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤\"\nreturn [{\n    json: {\n        errorHandled: true\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        240,
        656
      ],
      "id": "9807c36c-f285-4ca6-8d46-d6d0eee1e382",
      "name": "error to main"
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/home/node/final_report.csv",
        "options": {
          "append": true
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        672,
        176
      ],
      "id": "9fdddd40-d64c-49db-8bd0-bc78b870ea8f",
      "name": "Write Files from Disk"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "1b71cf16-409e-4132-8461-57ccdc42fd90",
              "leftValue": "={{ $json.error }}",
              "rightValue": false,
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -448,
        1280
      ],
      "id": "511a73bd-750d-404a-8c96-b3e390b0c590",
      "name": "error"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://chat.googleapis.com/v1/spaces/AAQA4vVH8yY/messages?key=AIzaSyDdI0hCZtE6vySjMm-WEfRq3CPzqKqqsHI&token=mDogCDO_DXBkboDcHu6YLs8nds4F589Y7-Gh6mwsNNI",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "text",
              "value": "=üö®{{ $('Config Folder & Brand1').first().json.brandName }}\n‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î\n{{ $json.errorMessage }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -208,
        1296
      ],
      "id": "eb464ef9-2871-42c6-8649-bd02dfb5a917",
      "name": "Notify1",
      "executeOnce": true
    },
    {
      "parameters": {
        "jsCode": "// ================= CONFIGURATION =================\nconst currentPlatform = 'Shopee'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Shopee, Tiktok ‡∏ï‡∏≤‡∏° Workflow\n\n// ‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Header ‡∏ó‡∏µ‡πà \"‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏à‡∏≠\" (‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)\nconst expectedColumns = [\n  'orderItemId',\n  'orderType',\n  'Guarantee',\t\n  'deliveryType',\t\n  'lazadaId',\t\n  'sellerSku',\t\n  'lazadaSku',\n  'wareHouse',\t\n  'createTime',\t\n  'updateTime',\n  'rtsSla',\t\n  'ttsSla',\n  'orderNumber',\n  'invoiceRequired',\n  'invoiceNumber',\t\n  'deliveredDate',\n  'customerName',\t\n  'customerEmail',\t\n  'nationalRegistrationNumber',\t\n  'shippingName',\t\n  'shippingAddress',\t\n  'shippingAddress2',\t\n  'shippingAddress3',\t\n  'shippingAddress4',\t\n  'shippingAddress5',\t\n  'shippingPhone',\t\n  'shippingPhone2',\n  'shippingCity',\t\n  'shippingPostCode',\t\n  'shippingCountry',\t\n  'shippingRegion',\t\n  'billingName',\n  'billingAddr',\t\n  'billingAddr2',\t\n  'billingAddr3',\t\n  'billingAddr4',\t\n  'billingAddr5',\t\n  'billingPhone',\t\n  'billingPhone2',\t\n  'billingCity',\t\n  'billingPostCode',\t\n  'billingCountry',\t\n  'taxCode',\t\n  'branchNumber',\t\n  'taxInvoiceRequested',\t\n  'payMethod',\t\n  'paidPrice',\t\n  'unitPrice',\t\n  'sellerDiscountTotal',\t\n  'shippingFee',\n  'walletCredit',\t\n  'itemName',\t\n  'variation',\t\n  'cdShippingProvider',\t\n  'shippingProvider',\t\n  'shipmentTypeName',\t\n  'shippingProviderType',\t\n  'cdTrackingCode',\t\n  'trackingCode',\t\n  'trackingUrl',\t\n  'shippingProviderFM',\t\n  'trackingCodeFM',\t\n  'trackingUrlFM',\t\n  'promisedShippingTime',\t\n  'premium',\t\n  'status',\t\n  'buyerFailedDeliveryReturnInitiator',\n  'buyerFailedDeliveryReason',\t\n  'buyerFailedDeliveryDetail',\t\n  'buyerFailedDeliveryUserName',\t\n  'bundleId',\t\n  'semiManaged',\t\n  'flexibleDeliveryTime',\t\n  'bundleDiscount',\t\n  'refundAmount',\n  // 'sellerNote'\n\n];\n// =================================================\nconst items = $input.all();\n\n// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö\nfunction getValidationError(json) {\n  if (!json) return null;\n  const actualHeadersRaw = Object.keys(json);\n  const actualHeadersNorm = actualHeadersRaw.map(k => k.trim().toLowerCase());\n  const expectedHeadersNorm = expectedColumns.map(k => k.trim().toLowerCase());\n\n  const missingColumns = expectedColumns.filter(reqCol => {\n    return !actualHeadersNorm.includes(reqCol.trim().toLowerCase());\n  });\n\n  const extraColumns = actualHeadersRaw.filter(actCol => {\n    return !expectedHeadersNorm.includes(actCol.trim().toLowerCase());\n  });\n\n  const countDiff = actualHeadersRaw.length - expectedColumns.length;\n\n  if (missingColumns.length > 0 || extraColumns.length > 0 || countDiff !== 0) {\n    let errorDetails = [];\n    if (countDiff !== 0) errorDetails.push(`üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${actualHeadersRaw.length} (‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á ${expectedColumns.length})`);\n    if (missingColumns.length > 0) errorDetails.push(`‚ùå ‡∏´‡∏≤‡∏¢: ${missingColumns.join(', ')}`);\n    if (extraColumns.length > 0) errorDetails.push(`üÜï ‡πÄ‡∏Å‡∏¥‡∏ô: ${extraColumns.join(', ')}`);\n\n    return `‚ö†Ô∏è [${currentPlatform}] ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô!\\n` + errorDetails.join('\\n');\n  }\n  return null;\n}\n\n// ================= MAIN LOGIC =================\n\n// 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Input\nif (!items.length || !items[0].json) {\n   // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á item ‡∏õ‡∏•‡∏≠‡∏°‡πÜ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ\n   return [{\n     json: { error: true, errorMessage: `‚ö†Ô∏è [${currentPlatform}] ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Input` }\n   }];\n}\n\n// 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≤‡∏Å item ‡πÅ‡∏£‡∏Å (‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô)\nconst errorMsg = getValidationError(items[0].json);\n\n// 3. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠ Error -> \"‡πÅ‡∏õ‡∏∞‡∏õ‡πâ‡∏≤‡∏¢\" Error ‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß ‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ\nif (errorMsg) {\n  return items.map(item => {\n    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô\n    return {\n      json: {\n        ...item.json,       // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Transaction ‡πÄ‡∏î‡∏¥‡∏° (Order ID, Price, ‡∏Ø‡∏•‡∏Ø)\n        error: true,        // üö© ‡∏ò‡∏á‡πÅ‡∏î‡∏á\n        errorMessage: errorMsg // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô\n      }\n    };\n  });\n}\n\n// 4. ‡∏ñ‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ -> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢ (‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô)\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -464,
        1056
      ],
      "id": "bd04de4a-ba47-4656-9efe-3206b44dd062",
      "name": "validate header"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        240,
        0
      ],
      "id": "3cf8ae56-3c66-48d9-8d3e-81d2164d010b",
      "name": "Merge"
    }
  ],
  "connections": {
    "Filterfiles_Shopee1": {
      "main": [
        [
          {
            "node": "If have file3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If have file3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Data transformation SH1": {
      "main": [
        [
          {
            "node": "If not error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders SHOPEE1": {
      "main": [
        [
          {
            "node": "Filterfiles_Shopee1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Write Files from Disk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Config Folder & Brand1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [
          {
            "node": "Extract fileID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Data transformation SH1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "enter new line": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config Folder & Brand1": {
      "main": [
        [
          {
            "node": "Config variable for regex1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Config variable for regex1": {
      "main": [
        [
          {
            "node": "Search files and folders SHOPEE1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File Shopee1": {
      "main": [
        [
          {
            "node": "validate header",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file Shopee": {
      "main": [
        [
          {
            "node": "Extract from File Shopee1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download file Shopee",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If not error": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Notify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notify": {
      "main": [
        [
          {
            "node": "error to main",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write Files from Disk": {
      "main": [
        [
          {
            "node": "enter new line",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "error": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Notify1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "validate header": {
      "main": [
        [
          {
            "node": "error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notify1": {
      "main": [
        [
          {
            "node": "Extract fileID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract fileID": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataSuccessExecution": "none",
    "saveManualExecutions": false,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "485fe552-5406-4ba0-ad27-cd4b4312b27c",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-12-01T07:08:04.224Z",
      "createdAt": "2025-12-01T07:08:04.224Z",
      "role": "workflow:owner",
      "workflowId": "037oeU0xxB2nPCMT",
      "projectId": "wgOKw36KVCTZkEHc"
    }
  ],
  "tags": []
}